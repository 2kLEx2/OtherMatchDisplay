<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>OBS Widget Setup</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: white;
      padding: 2rem;
    }
    button, select {
      padding: 0.5rem;
      font-size: 1rem;
      margin: 0.5rem 0;
      width: 100%;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>OBS Widget Setup</h1>
  <label>Select Live CS2 Match:
    <select id="matchSelect">
      <option value="">Loading matches...</option>
    </select>
  </label>
  <button onclick="generateURL()">Generate Display URL</button>
  <p id="output"></p>

  <script>
    const API_TOKEN = 'wfFUseEzf2SdWTjBIUHMvCYoE1p_1jQ834Cg0GBpIHHGusAIOWY';

    async function loadMatches() {
      try {
        const res = await fetch(`https://api.pandascore.co/cs2/matches?filter[status]=running&token=${API_TOKEN}`);
        const data = await res.json();
        const select = document.getElementById('matchSelect');
        select.innerHTML = '';
        if (data.length === 0) {
          select.innerHTML = '<option value="">No live matches found</option>';
          return;
        }
        data.forEach(match => {
          const name = match.name || `${match.opponents[0]?.opponent?.name || 'TBD'} vs ${match.opponents[1]?.opponent?.name || 'TBD'}`;
          const option = document.createElement('option');
          option.value = match.id;
          option.textContent = `${name} (ID: ${match.id})`;
          select.appendChild(option);
        });
      } catch (e) {
        const select = document.getElementById('matchSelect');
        select.innerHTML = '<option value="">Error loading matches</option>';
      }
    }

    function generateURL() {
      const matchId = document.getElementById('matchSelect').value;
      if (!matchId) return;
      const url = `display.html?token=${API_TOKEN}&match=${matchId}`;
      document.getElementById('output').innerHTML = `<strong>Copy this URL into OBS:</strong><br><code>${url}</code>`;
    }

    loadMatches();
  </script>
</body>
</html>